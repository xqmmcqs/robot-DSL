客服机器人逻辑
==============

概述
----

客服机器人与用户的交互一般为一问一答或者一问多答，因此客服机器人的底层逻辑被设计为一个拓广的Mealy状态机，其输入可能是用户字符串，或者用户未执行操作的秒数；其输出通常是一个字符串序列。

针对用户的输入，机器人可以对各个可行的转移 *条件* 进行判断，如果满足某个条件，则执行该分支下的所有 *动作* 。

此外，可以自定义一些用户变量，用于简单存储相关的信息，用户变量持久保存在数据库中。

转移逻辑
--------

如前所述，对于输入是用户字符串的情况，状态机中的每个状态会保存一个转移条件 *列表* ，状态机依次检查列表中的每一个条件，如果用户的输入满足一个条件，则执行该条件下的所有动作，并且忽略之后的所有条件。
每个状态必须有一个 `Default` 转移，表示当条件列表中的条件都不满足时，执行默认的动作。简而言之，条件的检查类似于 `if-elif-else` 逻辑。

对于输入是用户未执行操作的秒数，状态机中的每个状态会保存一个超时转移 *字典* ，客户端应当每隔一段时间返回用户未操作的秒数，状态机检查字典中是否包含
当前时间间隔中的时刻，如果包含，就执行相应的动作。

转移条件
--------



.. autoclass:: server.state_machine.UserVariableSet
   :members:
